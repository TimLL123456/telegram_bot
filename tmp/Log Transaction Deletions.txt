CREATE OR REPLACE FUNCTION log_transaction_delete()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO Transaction_History (
        transaction_id,
        date,
        category_id,
        description,
        currency,
        amount,
        modified_at,
        modification_type
    ) VALUES (
        OLD.transaction_id,
        OLD.date,
        OLD.category_id,
        OLD.description,
        OLD.currency,
        OLD.amount,
        NOW(),
        'DELETE'
    );
    RETURN OLD;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER before_transaction_delete
BEFORE DELETE ON Transactions
FOR EACH ROW
EXECUTE FUNCTION log_transaction_delete();