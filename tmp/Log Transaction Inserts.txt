CREATE OR REPLACE FUNCTION log_transaction_insert()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO Transaction_History (
        transaction_id,
        date,
        category_id,
        description,
        currency,
        amount,
        modified_at,
        modification_type
    ) VALUES (
        NEW.transaction_id,
        NEW.date,
        NEW.category_id,
        NEW.description,
        NEW.currency,
        NEW.amount,
        NOW(),
        'INSERT'
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER after_transaction_insert
AFTER INSERT ON Transactions
FOR EACH ROW
EXECUTE FUNCTION log_transaction_insert();